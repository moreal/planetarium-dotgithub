name: Push Docker Image

on:
  workflow_call:
    inputs:
      working_directory:
        required: false
        type: string
        default: /
      repository:
        required: true
        type: string
      tag:
        required: false
        type: string
        default: git-${{ github.sha }}
    secrets:
      token:
        required: true

jobs:
  build_and_push:
    runs-on: ubuntu-20.04
    steps:
      - name: checkout
        uses: actions/checkout@v2.3.4
      - name: login
        run: docker login --username ${{ secrets.DOCKER_USERNAME }} --password ${{ secrets.DOCKER_HUB_ACCESS_TOKEN }}
      - name: build
        run: docker build -t planetariumhq/${{ inputs.repository }}:${{ inputs.tag }} .
        working-directory: ${{ inputs.working_directory }}
      - name: push (publish)
        run: docker push planetariumhq/${{ inputs.repository }}:${{ inputs.tag }}
